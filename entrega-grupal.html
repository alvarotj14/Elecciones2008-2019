<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Juan Daza (DNI: 05733964-H), Guillermo Sanz (DNI: 1245391-J), Álvaro Tortajada (DNI: 06635393-P)">

<title>Entrega grupal</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="entrega-grupal_files/libs/clipboard/clipboard.min.js"></script>
<script src="entrega-grupal_files/libs/quarto-html/quarto.js"></script>
<script src="entrega-grupal_files/libs/quarto-html/popper.min.js"></script>
<script src="entrega-grupal_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="entrega-grupal_files/libs/quarto-html/anchor.min.js"></script>
<link href="entrega-grupal_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="entrega-grupal_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="entrega-grupal_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="entrega-grupal_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="entrega-grupal_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#instrucciones-leer-antes-de-empezar" id="toc-instrucciones-leer-antes-de-empezar" class="nav-link active" data-scroll-target="#instrucciones-leer-antes-de-empezar">Instrucciones (leer antes de empezar)</a>
  <ul class="collapse">
  <li><a href="#paquetes-necesarios" id="toc-paquetes-necesarios" class="nav-link" data-scroll-target="#paquetes-necesarios">Paquetes necesarios</a></li>
  </ul></li>
  <li><a href="#práctica-grupal" id="toc-práctica-grupal" class="nav-link" data-scroll-target="#práctica-grupal">Práctica grupal</a>
  <ul class="collapse">
  <li><a href="#datos" id="toc-datos" class="nav-link" data-scroll-target="#datos">Datos</a></li>
  <li><a href="#objetivos-e-ítems-obligatorios" id="toc-objetivos-e-ítems-obligatorios" class="nav-link" data-scroll-target="#objetivos-e-ítems-obligatorios">Objetivos e ítems obligatorios</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Entrega grupal</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Juan Daza (DNI: 05733964-H), Guillermo Sanz (DNI: 1245391-J), Álvaro Tortajada (DNI: 06635393-P) </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="instrucciones-leer-antes-de-empezar" class="level2">
<h2 class="anchored" data-anchor-id="instrucciones-leer-antes-de-empezar">Instrucciones (leer antes de empezar)</h2>
<ul>
<li><p>Modificad dentro del documento <code>.qmd</code> vuestros datos personales (nombres y DNI) ubicados en la cabecera del archivo.</p></li>
<li><p>Aseguraos, <strong>ANTES de seguir editando</strong> el documento, que el archivo <code>.qmd</code> se renderiza correctamente y se genera el <code>.html</code> correspondiente en tu carpeta local de tu ordenador.</p></li>
<li><p>Los chunks (cajas de código) creados están o vacíos o incompletos. Una vez que editeis lo que consideres, debeis ir cambiando cada chunck a <code>#| eval: true</code> (o quitarlo directamente) para que se ejecuten.</p></li>
<li><p>Recordad que puedes ejecutar chunk a chunk con el botón <em>play</em> o ejecutar todos los chunk hasta uno dado (con el botón a la izquierda del anterior).</p></li>
</ul>
<section id="paquetes-necesarios" class="level3">
<h3 class="anchored" data-anchor-id="paquetes-necesarios">Paquetes necesarios</h3>
<blockquote class="blockquote">
<p>Introduce en el chunk inferior los paquetes que vayas a necesitar</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># Borramos variables de environment</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section>
</section>
<section id="práctica-grupal" class="level2">
<h2 class="anchored" data-anchor-id="práctica-grupal">Práctica grupal</h2>
<section id="datos" class="level3">
<h3 class="anchored" data-anchor-id="datos">Datos</h3>
<p>La práctica versará entorno a los <strong>archivos de datos electorales</strong> que ya hemos trabajado, recopilando datos de citas electorales al Congreso de los Diputados de España desde 2008 hasta la actualidad</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NO TOQUES NADA</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>datos_elecciones <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"./datos/datos_elecciones_brutos.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 48737 Columns: 471
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (5): tipo_eleccion, mes, codigo_ccaa, codigo_provincia, codigo_municipio
dbl (424): anno, vuelta, codigo_distrito_electoral, numero_mesas, censo, par...
lgl  (42): FALANGE ESPAÑOLA DE LA JONS, PARTIDO COMUNISTA DEL PUEBLO CASTELL...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>cod_mun <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"./datos/cod_mun.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8135 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): cod_mun, municipio

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>encuestas <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"./datos/historical_surveys.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3753 Columns: 59
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (4): type_survey, id_pollster, pollster, media
dbl  (51): size, turnout, UCD, PSOE, PCE, AP, CIU, PA, EAJ-PNV, HB, ERC, EE,...
lgl   (1): exit_poll
date  (3): date_elec, field_date_from, field_date_to

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>siglas <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"./datos/siglas.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 587 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): denominacion, siglas

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Los datos serán los siguientes:</p>
<ul>
<li><p><code>datos_elecciones</code>: archivo con los datos electorales al Congreso desde 2018 hasta las últimas de 2019.</p>
<ul>
<li><code>tipo_eleccion</code>: tipo de elección (02 si es elección al congreso)</li>
<li><code>anno</code>, <code>mes</code>: año y mes de las elecciones</li>
<li><code>vuelta</code>: vuelta electoral (1 si es primera vuelta)</li>
<li><code>codigo_ccaa, codigo_provincia, codigo_municipio, codigo_distrito_electoral</code>: código de la ccaa, provincia, municipio y distrito electoral.</li>
<li><code>numero_mesas</code>: número de mesas electorales</li>
<li><code>censo</code>: censo electoral</li>
<li><code>participacion_1, participacion_2</code>: participación en el primer avance (14:00) y segundo avance (18:00) antes del cierre de urnas (20:00)</li>
<li><code>votos_blancos</code>: votos en blanco</li>
<li><code>votos_candidaturas</code>: votos a papeletas de partidos</li>
<li><code>votos_nulos</code>: votos nulos</li>
<li>votos recibidos por cada uno de los partidos</li>
</ul></li>
<li><p><code>cod_mun</code>: archivo con los códigos y nombres de cada municipio</p></li>
<li><p><code>siglas</code>: siglas y nombres asociados a cada partido</p></li>
<li><p><code>encuestas</code>: tabla de encuestas electorales desde 1982. Algunas de las variables son las siguientes:</p>
<ul>
<li><code>type_survey</code>: tipo de encuesta (nacional, autonómica, etc)</li>
<li><code>date_elec</code>: fecha de las futuras elecciones</li>
<li><code>id_pollster</code>, <code>pollster</code>, <code>media</code>: identificador y nombre de la casa encuestadora, así como el medio que lo haya encargado</li>
<li><code>field_date_from</code>, <code>field_date_to</code>: fecha de inicio y final del trabajo de campo</li>
<li><code>exit_poll</code>: si se trata de una encuesta a pie de urna o no</li>
<li><code>size</code>: tamaño muestral</li>
<li><code>turnout</code>: estimación de la participación</li>
<li>estimación de intención de voto para los principales partidos</li>
</ul></li>
</ul>
</section>
<section id="objetivos-e-ítems-obligatorios" class="level3">
<h3 class="anchored" data-anchor-id="objetivos-e-ítems-obligatorios">Objetivos e ítems obligatorios</h3>
<p>El objetivo de la entrega es realizar un análisis de los datos electorales, llevando a cabo la depuración, resúmenes y gráficos que consideres, tanto de sus resultaados como del acierto de las encuestas electorales.</p>
<p>En concreto <strong>se deberá trabajar solo en la ventana temporal que comprenden las elecciones desde 2008 hasta las últimas elecciones de 2019</strong>.</p>
<section id="indicaciones-generales" class="level4">
<h4 class="anchored" data-anchor-id="indicaciones-generales">Indicaciones generales</h4>
<p>Amén de lo que te parezca oportuno ejecutar, serán obligatorios los siguientes ítems:</p>
<ul>
<li><p>Cada grupo deberá presentar <strong>al menos 48 horas antes un análisis de los datos</strong> en formato <code>.qmd</code> y <code>.html</code> en modo <strong>diapositivas</strong>, que <strong>serán las que expongan el día de la presentación</strong>.</p></li>
<li><p>Durante la presentación se <strong>explicará el análisis realizado</strong> de manera que <strong>cada miembro del equipo habla un tiempo similar</strong> y <strong>cada miembro podrá ser preguntado por cualquiera de los pasos</strong>. La nota no tendrá porque ser la misma para todos/as los/as integrantes.</p></li>
<li><p>Se valorará no solo el contenido sino el continente (estética).</p></li>
<li><p>Se valorará positivamente que las diapositivas estén alojadas en Github.</p></li>
<li><p>El objetivo es demostrar que se adquirido el máximo de conocimientos del curso: cuantas más contenido del temario se incluya, mejor.</p></li>
</ul>
</section>
<section id="ítems-obligatorios" class="level4">
<h4 class="anchored" data-anchor-id="ítems-obligatorios">Ítems obligatorios:</h4>
<ul>
<li><p>Se deberá de <strong>convertir los datos a tidydata</strong> cuando proceda.</p></li>
<li><p>Se deberá <strong>incluir al menos un cruce (join)</strong> entre tablas.</p></li>
<li><p>Reminder: información = varianza, así que se deberán <strong>retirar columnas que no nos van a aportar nada</strong>.</p></li>
<li><p>Se deberá usar el <strong>paquete glue y lubridate</strong> en algún momento, así como el paquete <strong>forcats</strong>, <strong>ggplot2</strong> y <strong>plotly</strong></p></li>
<li><p>Se deberá usar al menos una vez lo siguiente:</p>
<ul>
<li>mutate</li>
<li>summarise</li>
<li>group_by (o equivalente)</li>
<li>case_when</li>
</ul></li>
<li><p>Tenemos muchísimos partidos que se presentan a las elecciones. Solo nos intereserán los siguientes partidos:</p>
<ul>
<li>PARTIDO SOCIALISTA OBRERO ESPAÑOL (cuidado: tiene/tuvo federaciones - sucursales - con algún otro nombre)</li>
<li>PARTIDO POPULAR</li>
<li>CIUDADANOS (cuidado: tiene/tuvo federaciones - sucursales - con algún otro nombre)</li>
<li>PARTIDO NACIONALISTA VASCO</li>
<li>BLOQUE NACIONALISTA GALEGO</li>
<li>COMPROMÍS</li>
<li>CONVERGÈNCIA I UNIÓ</li>
<li>UNIDAS PODEMOS - IU (cuidado que aquí han tenido nombres variados - IU, los verdes, podem, ezker batua, …- y no siempre han ido juntos, pero aquí los analizaremos juntos</li>
<li>ESQUERRA REPUBLICANA DE CATALUNYA</li>
<li>EH - BILDU (son ahora una coalición de partidos formados por Sortu, Eusko Alkartasuna, Aralar, Alternatiba)</li>
<li>MÁS PAÍS</li>
<li>VOX7*</li>
</ul></li>
<li><p>Todo lo que no sea alguno de los anteriores partidos deberá ser imputado como “OTROS”. Recuerda agregar los datos tras la recodificación anterior.</p></li>
<li><p>Para las visualizaciones se usarán las siglas de los partidos. El trabajo deberá contener al menos 5 gráficas, de las cuales al menos 3 deben ser tipos de gráficos distintos (ver <a href="https://r-graph-gallery.com/" class="uri">https://r-graph-gallery.com/</a>), todas ellas con un tema personalizado</p></li>
<li><p>Deberás usar los 4 archivos de datos en algún momento</p></li>
<li><p>Deberás definir al menos una función propia (que no sea trivial)</p></li>
<li><p>Deberás descartar obligatoriamente las encuestas que:</p>
<ul>
<li>hagan referencia a elecciones anteriores a 2018</li>
<li>que sean a pie de urna</li>
<li>que tenga un tamaño muestral inferior a 750 o que sea desconocido</li>
<li>que tengan menos de 1 o menos días de trabajo de campo</li>
</ul></li>
<li><p>Deberás responder obligatoriamente a las siguientes preguntas (más las que consideres analizar para distinguirte del resto de equipos, ya sea numérica y/o gráficamente, pudiendo responder con números y/o con gráficos, decidiendo la mejor visualización que consideres.)</p>
<ul>
<li>¿Cómo se reparte el voto de partidos de ámbito nacional (PSOE, PP, VOX, CS, MP, UP - IU) frente a los partidos de corte autonómico o nacionalista?</li>
<li>¿Cuál el partido ganador en los municipios de más de 100 000 habitantes de censo en cada una de las elecciones?</li>
<li>¿Qué partido fue el segundo cuando el primero fue el PSOE? ¿Y cuándo el primero fue el PP?</li>
<li>¿En qué municipios de más 2000 habitantes de censo, provincias o autonomías la diferencia entre el ganador y el segundo es más elevada?</li>
<li>¿Cuáles son los municipios con mayor porcentaje de votos nulos de España?</li>
<li>¿En qué sitios hay mayor participación? ¿Quién ganó en los sitios con mayor participación y donde menos? ¿A quién le beneficia la baja participación?</li>
<li>¿Cómo analizar la relación entre censo y voto? ¿Es cierto que ciertos partidos ganan lo rural?</li>
<li>¿Cómo calibrar el error de las encuestas? ¿Cómo visualizarlo? (recuerda que las encuestas son intención de voto a nivel nacional)</li>
<li>¿En qué elección se equivocaron más las encuestas?</li>
<li>¿Cómo se equivocaron las encuestas en partidos de ámbito nacional (PSOE, PP, VOX, CS, MP, UP - IU)</li>
<li>¿Qué casas encuestadores acertaron más y cuales se desviaron más de los resultados?</li>
</ul></li>
</ul>
</section>
<section id="calificación" class="level4">
<h4 class="anchored" data-anchor-id="calificación">Calificación</h4>
<p><strong>No se valorará más al que más cosas haga</strong>. Más no siempre es mejor. Se valorará la <strong>originalidad</strong> (respecto al resto de trabajos, por ejemplo en lo analizado o en el tema o …) de lo planteado, tanto en manejo de tablas como en visualización, el <strong>cariño</strong> puesto en la entrega (el cariño en la vida es importante) y la <strong>pertinencia</strong> de lo realizado. Una vez que tengáis los ítems obligatorios con tu base de datos más o menos completada, <strong>piensa antes</strong> de ponerte a picar código: ¿qué puede ser interesante? ¿Qué necesito para poder obtener un resumen tanto numérico tanto visual?</p>
<p>Recordad que el fin real es demostrarme un dominio de las herramientas vistas a lo largo del curso. Y eso pasa no solo por la cantidad de ellas utilizadas sino por la calidad al ejecutarlas.</p>
</section>
<section id="tidydata" class="level4">
<h4 class="anchored" data-anchor-id="tidydata">Tidydata</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  datos_elecciones <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span> <span class="sc">-</span>(<span class="st">"tipo_eleccion"</span><span class="sc">:</span><span class="st">"votos_candidaturas"</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to=</span><span class="st">"Partidos"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span> <span class="st">"Votos"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na=</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(tipo_eleccion, vuelta, codigo_distrito_electoral))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>encuestas_tidy <span class="ot">&lt;-</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  encuestas <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span> <span class="sc">-</span>(<span class="st">"type_survey"</span><span class="sc">:</span><span class="st">"turnout"</span>),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to=</span> <span class="st">"Partidos"</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span><span class="st">"Estimación"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na=</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((<span class="fu">year</span>(date_elec))<span class="sc">&gt;=</span><span class="dv">2018</span> <span class="sc">&amp;</span> exit_poll<span class="sc">==</span><span class="cn">FALSE</span> <span class="sc">&amp;</span> size<span class="sc">&gt;=</span><span class="dv">750</span> <span class="sc">&amp;</span> </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>           (<span class="fu">day</span>(field_date_from)<span class="sc">-</span><span class="fu">day</span>(field_date_to))<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">siglas =</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Partidos, <span class="st">"PARTIDO SOCIALISTA OBRERO|PARTIT DELS SOCIALISTES DE CATALUNYA|PARTIDO DOS SOCIALISTAS DE GALICIA|PSOE"</span>) <span class="sc">~</span> <span class="st">"PSOE"</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"PARTIDO POPULAR|PP"</span>) <span class="sc">~</span> <span class="st">"PP"</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"CIUDADANOS|CIUTADANS|CS"</span>) <span class="sc">~</span> <span class="st">"CS"</span>,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">str_detect</span>(Partidos, <span class="st">"PODEMOS|PODEM|IU|LOS VERDES|PODEM|EZKER BATUA|UP"</span>) <span class="sc">~</span> <span class="st">"UP"</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                     </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"VOX"</span>) <span class="sc">~</span> <span class="st">"VOX"</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos,<span class="st">"SORTU|EUSKO ALKARTASUNA|ARALAR| ALTERNATIBA|EH-BILDU"</span>)<span class="sc">~</span> <span class="st">"EH-BILDU"</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"COMPROMIS"</span>) <span class="sc">~</span> <span class="st">"COMPROMIS"</span>,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"CONVERGENCIA I UNIO|CIU"</span>) <span class="sc">~</span> <span class="st">"CIU"</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"ESQUERRA|ERC"</span>) <span class="sc">~</span> <span class="st">"ERC"</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"MAS PAIS|MP"</span>) <span class="sc">~</span> <span class="st">"MP"</span>,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                     <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"OTROS"</span>))</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="ot">&lt;-</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">siglas =</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Partidos, <span class="st">"PARTIDO SOCIALISTA OBRERO|PARTIT DELS SOCIALISTES DE CATALUNYA|PARTIDO DOS SOCIALISTAS DE GALICIA|PSOE"</span>) <span class="sc">~</span> <span class="st">"PSOE"</span>,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"PARTIDO POPULAR|PP"</span>) <span class="sc">~</span> <span class="st">"PP"</span>,</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"CIUDADANOS|CIUTADANS|CS"</span>) <span class="sc">~</span> <span class="st">"CS"</span>,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">str_detect</span>(Partidos, <span class="st">"PODEMOS|PODEM|IU|LOS VERDES|PODEM|EZKER BATUA|UP"</span>) <span class="sc">~</span> <span class="st">"UP"</span>,</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                     </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"VOX"</span>) <span class="sc">~</span> <span class="st">"VOX"</span>,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos,<span class="st">"SORTU|EUSKO ALKARTASUNA|ARALAR| ALTERNATIBA|EH-BILDU"</span>)<span class="sc">~</span> <span class="st">"EH-BILDU"</span>,</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"COMPROMIS"</span>) <span class="sc">~</span> <span class="st">"COMPROMIS"</span>,</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"CONVERGENCIA I UNIO|CIU"</span>) <span class="sc">~</span> <span class="st">"CIU"</span>,</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"ESQUERRA|ERC"</span>) <span class="sc">~</span> <span class="st">"ERC"</span>,</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">str_detect</span>(Partidos, <span class="st">"MAS PAIS|MP"</span>) <span class="sc">~</span> <span class="st">"MP"</span>,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>                     <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"OTROS"</span>))</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="ot">&lt;-</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  datos_elecciones_tidy <span class="sc">|&gt;</span> </span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fecha =</span> <span class="fu">ymd</span>(<span class="fu">glue</span>(<span class="st">"{anno}{mes}01"</span>)),</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">cod_mun=</span> <span class="fu">glue</span>(<span class="st">"{codigo_ccaa}-{codigo_provincia}-{codigo_municipio}"</span>))</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="ot">&lt;-</span> </span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  datos_elecciones_tidy <span class="sc">|&gt;</span> <span class="fu">left_join</span>(cod_mun, <span class="at">by=</span><span class="st">"cod_mun"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ejercicio-1" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-1">Ejercicio 1</h4>
<ul>
<li>¿Cómo se reparte el voto de partidos de ámbito nacional (PSOE, PP, VOX, CS, MP, UP - IU) frente a los partidos de corte autonómico o nacionalista?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Ejercicio de gráfica</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ambito_nacional <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PSOE"</span>, <span class="st">"PP"</span>, <span class="st">"VOX"</span>, <span class="st">"MP"</span>, <span class="st">"UP"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="ot">&lt;-</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ambito=</span> <span class="fu">case_when</span>(</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  siglas <span class="sc">%in%</span> ambito_nacional <span class="sc">~</span> <span class="st">"Nacional"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Autonómico/Nacionalista"</span>))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>grafico1<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha, ambito) <span class="sc">|&gt;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">"VotosTotal"</span><span class="ot">=</span><span class="fu">sum</span>(Votos))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'fecha'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grafico1<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(fecha), <span class="at">y =</span> VotosTotal, <span class="at">fill=</span>ambito)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">25000000</span>, <span class="at">by =</span> <span class="dv">5000000</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(<span class="at">scale =</span> <span class="fl">1e-6</span>)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_foundation</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Elecciones"</span>, <span class="at">y =</span> <span class="st">"Votos en millones"</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="entrega-grupal_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En el ejercicio 1 se pide comparar el voto de los partidos de ámbito nacional frente a los partidos de ámbito autonómico. Para ello se han agrupado los partidos en los dos grupos correspondientes y se ha generado un gráfico de barras en el que se observa la comparativa a lo largo del tiempo.</p>
<p>Se puede observar como los partidos autonómicos han ido cogiendo fuerza a lo largo del tiempo, con claros repuntes a finales de 2015 y principios de 2019, a pesar de esto son una clara minoría respecto a los partidos de ámbito nacional.</p>
</section>
<section id="ejercicio-2" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-2">Ejercicio 2</h4>
<ul>
<li>¿Cuál el partido ganador en los municipios de más de 100 000 habitantes de censo en cada una de las elecciones?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>n_votado <span class="ot">&lt;-</span> <span class="cf">function</span>(Partidos, Votos, <span class="at">n =</span> <span class="dv">1</span>) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  datos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Partidos, Votos)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  siglas <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Votos)) <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(Partidos)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(siglas)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(censo <span class="sc">&gt;</span> <span class="dv">100000</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha, cod_mun) <span class="sc">|&gt;</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Votos, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(fecha, cod_mun, municipio, siglas))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 282 × 4
# Groups:   fecha, cod_mun [282]
   fecha      cod_mun   municipio            siglas
   &lt;date&gt;     &lt;glue&gt;    &lt;chr&gt;                &lt;chr&gt; 
 1 2008-03-01 01-04-013 Almería              PP    
 2 2008-03-01 01-11-012 Cádiz                PSOE  
 3 2008-03-01 01-11-020 Jerez de la Frontera PSOE  
 4 2008-03-01 01-14-021 Córdoba              PP    
 5 2008-03-01 01-18-087 Granada              PP    
 6 2008-03-01 01-21-041 Huelva               PSOE  
 7 2008-03-01 01-29-067 Málaga               PSOE  
 8 2008-03-01 01-41-091 Sevilla              PSOE  
 9 2008-03-01 02-50-297 Zaragoza             PSOE  
10 2008-03-01 03-33-024 Gijón                PSOE  
# ℹ 272 more rows</code></pre>
</div>
</div>
<p>Se pide extraer el ganador en los municipios cuyo censo es mayor a 100.000 en cada una de las elecciones, para ello se agrupan los datos en función de la fecha y el municipio, luego se filtran los datos según el censo requerido y se calcula el partido ganador. En los resultados se observa que el PP y el PSOE son los resultados más frecuentes de manera aplastante c aunque existen algunas excepción como Unidas Podemos, Vox u otros.</p>
</section>
<section id="ejercicio-3" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-3">Ejercicio 3</h4>
<ul>
<li>¿Qué partido fue el segundo cuando el primero fue el PSOE? ¿Y cuándo el primero fue el PP?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>grafico3<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha, cod_mun) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Votos, <span class="at">n=</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(siglas[<span class="dv">1</span>]<span class="sc">==</span><span class="st">"PSOE"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(fecha, cod_mun, municipio, siglas, Votos)) <span class="sc">|&gt;</span> <span class="co">#El select ayuda a previsualizar durante la creación del código no es necesario.</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(siglas<span class="sc">!=</span><span class="st">"PSOE"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siglas) <span class="sc">|&gt;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>grafico3<span class="fl">.2</span> <span class="ot">&lt;-</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha, cod_mun) <span class="sc">|&gt;</span> </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Votos, <span class="at">n=</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(siglas[<span class="dv">1</span>]<span class="sc">==</span><span class="st">"PP"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(fecha, cod_mun, municipio, siglas, Votos)) <span class="sc">|&gt;</span> <span class="co">#El select ayuda a previsualizar durante la creación del código no es necesario.</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(siglas<span class="sc">!=</span><span class="st">"PP"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siglas) <span class="sc">|&gt;</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>pal1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#1E4964"</span>, <span class="st">"#FF9E00"</span>, <span class="st">"#FFD52C"</span>, <span class="st">"#2CFFD5"</span>, <span class="st">"#5D5D5D"</span>, <span class="st">"#1E49A4"</span>, <span class="st">"#850081"</span>, <span class="st">"#00FF04"</span>)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(grafico3<span class="fl">.1</span><span class="sc">$</span>n, <span class="at">labels=</span> grafico3<span class="fl">.1</span><span class="sc">$</span>siglas,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span> pal1,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span> <span class="st">"Gráfica de Sectores sobre los segundos puestos tras el PSOE"</span>,</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="st">"white"</span>,</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">edges=</span><span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="entrega-grupal_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>pal2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#1E4964"</span>, <span class="st">"#FF9E00"</span>, <span class="st">"#FFD52C"</span>, <span class="st">"#2CFFD5"</span>, <span class="st">"#5D5D5D"</span>, <span class="st">"#FF0C00"</span>, <span class="st">"#850081"</span>, <span class="st">"#00FF04"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(grafico3<span class="fl">.2</span><span class="sc">$</span>n, <span class="at">labels=</span> grafico3<span class="fl">.2</span><span class="sc">$</span>siglas,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span> pal2,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span> <span class="st">"Gráfica de Sectores sobre los segundos puestos tras el PP"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">border =</span> <span class="st">"white"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">edges=</span><span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="entrega-grupal_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En el ejercicio 3 se estudia cuáles son los partidos que han quedado en segundo lugar, en aquellas elecciones que ha ganado el PP y el PSOE en los diferentes municipios proporcionados por la base de datos.</p>
<p>Para ello se ha seleccionado la posición número 2 en función de los votos y se ha filtrado en aquellas cuyo ganador era PP y PSOE. Se ha generado un gráfico diferente para cada uno de los dos casos, en estos se observa que cuando gana el PP el PSOE es el partido que queda en segundo lugar en más ocasiones y viceversa, esto demuestra el bipartidismo que ha existido siempre en la democracia española.</p>
</section>
<section id="ejercicio-4" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-4">Ejercicio 4</h4>
<ul>
<li>¿En qué municipios de más 2000 habitantes de censo, provincias o autonomías la diferencia entre el ganador y el segundo es más elevada?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(censo <span class="sc">&gt;</span> <span class="dv">2000</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha, cod_mun) <span class="sc">|&gt;</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Votos, <span class="at">n=</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dif_votos =</span> Votos[<span class="dv">1</span>] <span class="sc">-</span> Votos[<span class="dv">2</span>]) <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(municipio, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(fecha, cod_mun, municipio, dif_votos)) <span class="sc">|&gt;</span> <span class="do">##El select ayuda a previsualizar durante la creación del código no es necesario.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(dif_votos, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   fecha      cod_mun   municipio dif_votos
   &lt;date&gt;     &lt;glue&gt;    &lt;chr&gt;         &lt;dbl&gt;
 1 2011-11-01 12-28-079 Madrid       442069
 2 2016-06-01 12-28-079 Madrid       329278
 3 2015-12-01 12-28-079 Madrid       270065
 4 2008-03-01 12-28-079 Madrid       228121
 5 2008-03-01 09-08-019 Barcelona    184449
 6 2011-11-01 17-46-250 València     123301
 7 2019-04-01 12-28-079 Madrid       113158
 8 2011-11-01 15-30-030 Murcia       111669
 9 2015-12-01 09-08-019 Barcelona     93338
10 2008-03-01 15-30-030 Murcia        84045</code></pre>
</div>
</div>
<p>Las mayores diferencias se encuentran en las provincias con mayor censo. Se puede observar que en Madrid, Barcelona y Murcia se dan grandes diferencias en varias elecciones.</p>
<p>Para llegar a estos datos se filtra el censo para poblaciones mayores de 2000 habitantes y se agrupa según la fecha y el código del municipio. Posteriormente se busca quienes son los dos partidos más votados en cada eleccion y se crea una variable que contenga la diferencia de votos de los dos partidos.</p>
</section>
<section id="ejercicio-5" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-5">Ejercicio 5</h4>
<ul>
<li>¿Cuáles son los municipios con mayor porcentaje de votos nulos de España?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cod_mun, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cod_mun) <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">porcentaje_nulo=</span> (<span class="fu">sum</span>(votos_nulos)<span class="sc">/</span><span class="fu">sum</span>(votos_candidaturas))<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span> (<span class="fu">desc</span>(porcentaje_nulo)) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (<span class="fu">c</span>(cod_mun, municipio, porcentaje_nulo))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
# Groups:   cod_mun [5]
  cod_mun   municipio              porcentaje_nulo
  &lt;glue&gt;    &lt;chr&gt;                            &lt;dbl&gt;
1 08-34-149 Requena de Campos                 16.7
2 08-05-145 Narrillos del Rebollar            15.6
3 01-21-031 Encinasola                        12.5
4 08-42-082 Estepa de San Juan                12.5
5 08-37-332 Valdehijaderos                    11.5</code></pre>
</div>
</div>
<p>Se ha realizado la suma de todos los votos nulos de todas las elecciones para cada municipio para dividirlos entre el total de votos de las candidaturas para calcular el ratio de votos nulos sobre los votos de candidaturas.</p>
<p>Una vez hecho esto se observa los mayores porcentajes de votos nulos se dan en municipios pequeños con poco censo electoral como pueden ser Requena de Campos, Narrillos del Rebollar o Encinsola.</p>
</section>
<section id="ejercicio-6" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-6">Ejercicio 6</h4>
<ul>
<li>¿En qué sitios hay mayor participación? ¿Quién ganó en los sitios con mayor participación y donde menos? ¿A quién le beneficia la baja participación?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mas_part <span class="ot">&lt;-</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cod_mun, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Participacion=</span>participacion_1<span class="sc">+</span>participacion_2) <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Participacion, <span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(municipio) <span class="sc">|&gt;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span> (municipio)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>men_part <span class="ot">&lt;-</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha) <span class="sc">|&gt;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cod_mun, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Participacion=</span>participacion_1<span class="sc">+</span>participacion_2) <span class="sc">|&gt;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(Participacion, <span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(municipio) <span class="sc">|&gt;</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span> (municipio)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(municipio <span class="sc">%in%</span> mas_part) <span class="sc">|&gt;</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha, municipio) <span class="sc">|&gt;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Votos, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fecha, cod_mun, municipio, siglas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 4
# Groups:   fecha, municipio [30]
   fecha      cod_mun   municipio siglas
   &lt;date&gt;     &lt;glue&gt;    &lt;chr&gt;     &lt;chr&gt; 
 1 2008-03-01 09-08-019 Barcelona PSOE  
 2 2008-03-01 12-28-079 Madrid    PP    
 3 2008-03-01 01-41-091 Sevilla   PSOE  
 4 2008-03-01 17-46-250 València  PP    
 5 2008-03-01 02-50-297 Zaragoza  PSOE  
 6 2011-11-01 09-08-019 Barcelona OTROS 
 7 2011-11-01 12-28-079 Madrid    PP    
 8 2011-11-01 01-41-091 Sevilla   PP    
 9 2011-11-01 17-46-250 València  PP    
10 2011-11-01 02-50-297 Zaragoza  PP    
# ℹ 20 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(municipio <span class="sc">%in%</span> men_part) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha, municipio) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Votos, <span class="at">n=</span><span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fecha, cod_mun, municipio, siglas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 144 × 4
# Groups:   fecha, municipio [144]
   fecha      cod_mun   municipio               siglas
   &lt;date&gt;     &lt;glue&gt;    &lt;chr&gt;                   &lt;chr&gt; 
 1 2008-03-01 08-42-010 Aldealices              PP    
 2 2008-03-01 08-42-011 Aldealpozo              PP    
 3 2008-03-01 07-19-031 Angón                   PP    
 4 2008-03-01 07-16-020 Arandilla del Arroyo    PP    
 5 2008-03-01 08-42-051 Carabantes              PP    
 6 2008-03-01 08-40-161 Carabias                PP    
 7 2008-03-01 08-42-052 Caracena                PP    
 8 2008-03-01 08-42-054 Carrascosa de la Sierra PP    
 9 2008-03-01 07-19-079 Castilnuevo             PP    
10 2008-03-01 07-19-095 Condemios de Abajo      PP    
# ℹ 134 more rows</code></pre>
</div>
</div>
<p>En el código se han elegido los 5 partidos con menos participación en cada una de las elecciones, se han eliminado duplicados y se han exportado como vector para su posterior uso. Por eso en el caso de menor participación hay muchos municipios distintos.</p>
<p>Los municipios con mayor participación se caracterizan por ser poblaciones pequeñas con un censo reducido.</p>
<p>La baja participación beneficia totalmente a los partidos políticos regionales o de ámbito local. Habiendo encasillado varios partidos minoritarios con las siglas OTROS, se puede ver que en las zonas donde existe baja participación aparece esta categoria como ganador en muchas ocasiones. En zonas de baja participación los mayores beneficiados son los partidos mayoritarios como pueden ser PP o PSOE.</p>
</section>
<section id="ejercicio-7" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-7">Ejercicio 7</h4>
<ul>
<li>¿Cómo analizar la relación entre censo y voto? ¿Es cierto que ciertos partidos ganan lo rural?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="ot">&lt;-</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  datos_elecciones_tidy <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tamano_censo =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    censo <span class="sc">&lt;</span> <span class="dv">1000</span> <span class="sc">~</span> <span class="st">" Muy Pequeño"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    censo <span class="sc">&gt;=</span> <span class="dv">1000</span> <span class="sc">&amp;</span> censo <span class="sc">&lt;</span> <span class="dv">5000</span> <span class="sc">~</span> <span class="st">"Pequeño"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    censo <span class="sc">&gt;=</span> <span class="dv">5000</span> <span class="sc">&amp;</span> censo <span class="sc">&lt;</span> <span class="dv">10000</span> <span class="sc">~</span> <span class="st">"Mediano"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    censo <span class="sc">&gt;=</span> <span class="dv">10000</span> <span class="sc">&amp;</span> censo <span class="sc">&lt;</span><span class="dv">50000</span> <span class="sc">~</span> <span class="st">"Grande"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    censo <span class="sc">&gt;=</span> <span class="dv">50000</span> <span class="sc">~</span> <span class="st">"Muy Grande"</span>))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>grafico7<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  datos_elecciones_tidy <span class="sc">|&gt;</span> </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siglas, tamano_censo) <span class="sc">|&gt;</span> </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">"VotosTotal"</span><span class="ot">=</span> <span class="fu">sum</span>(Votos)) <span class="sc">|&gt;</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'siglas'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>grupo_ordenado <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Muy Pequeño'</span>, <span class="st">'Pequeño'</span>, <span class="st">'Mediano'</span>, <span class="st">'Grande'</span>, <span class="st">'Muy Grande'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>pal3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#1E4964"</span>,<span class="st">"#FFCE64"</span>,<span class="st">"#FF9E00"</span>, <span class="st">"#2CFFD5"</span>, <span class="st">"#FFD52C"</span>, <span class="st">"#64FF8A"</span>, <span class="st">"#5D5D5D"</span>, <span class="st">"#1E49A4"</span>, <span class="st">"#FF0C00"</span>, <span class="st">"#850081"</span>,<span class="st">"#00FF04"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grafico7<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x=</span> tamano_censo, <span class="at">y=</span> VotosTotal, <span class="at">fill=</span> siglas)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha=</span> <span class="fl">0.7</span>, <span class="at">position=</span><span class="st">'fill'</span>) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span> grupo_ordenado ) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_economist</span>() <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span> pal3) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="entrega-grupal_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El ejercicio 7 pide analizar la relación entre censo y voto, para ello se han agrupado los municipios en función de su censo, creando 5 categorías diferentes, dentro de estas categorías se ha estudiado la suma de votos para cada partido.</p>
<p>En el gráfico se observa la frecuencia relativa, gracias al position = ‘filll’, que permite que la escala de las diferentes categorías se pueda comparar.</p>
<p>En cuánto a los resultados observamos que en los municipios muy pequeños el PP es el gran beneficiado, mientras que el PSOE se mantiene bastante lineal en función del censo, en partidos más pequeños como Ciudadanos o Podemos se observa un mayor apoyo en municipios cuyo censo se encuentra en las categorías ‘pequeño’, ‘mediano’ y ‘grande’. Por otro lado, aparecen más los partidos minoritarios en las zonas con menor población.</p>
</section>
<section id="ejercicio-8" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-8">Ejercicio 8</h4>
<ul>
<li>¿Cómo calibrar el error de las encuestas? ¿Cómo visualizarlo? (recuerda que las encuestas son intención de voto a nivel nacional)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>encuestas_tidy2 <span class="ot">&lt;-</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  encuestas_tidy <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(Estimación<span class="ot">=</span> <span class="fu">mean</span>(Estimación), <span class="at">.by =</span> <span class="fu">c</span>(siglas, date_elec))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>candidatura_total <span class="ot">&lt;-</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha) <span class="sc">|&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cod_mun, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">candidatura_total=</span> <span class="fu">sum</span>(votos_candidaturas)) <span class="sc">|&gt;</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(fecha, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (<span class="fu">c</span>(fecha, candidatura_total)) <span class="sc">|&gt;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(fecha)<span class="sc">==</span><span class="dv">2019</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>ejer8 <span class="ot">&lt;-</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(fecha)<span class="sc">==</span><span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votos_totales =</span> <span class="fu">sum</span>(Votos), <span class="at">.by =</span> <span class="fu">c</span>(fecha, siglas)) <span class="sc">|&gt;</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(candidatura_total, <span class="at">by=</span><span class="st">"fecha"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha, siglas) <span class="sc">|&gt;</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">porcentaje=</span> <span class="dv">100</span><span class="sc">*</span> votos_totales<span class="sc">/</span>candidatura_total) <span class="sc">|&gt;</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(siglas, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (<span class="fu">c</span>(Partidos<span class="sc">:</span>porcentaje))</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>ejer8 <span class="ot">&lt;-</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  ejer8 <span class="sc">|&gt;</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(encuestas_tidy2, <span class="at">by=</span><span class="st">"siglas"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha) <span class="sc">|&gt;</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(siglas, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error=</span> <span class="fu">abs</span>(porcentaje<span class="sc">-</span>Estimación)) <span class="sc">|&gt;</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">siglas=</span> <span class="fu">fct_reorder</span>(siglas, error))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(ejer8, encuestas_tidy2, by = "siglas"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 4 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ejer8, <span class="fu">aes</span>(<span class="at">x=</span> siglas, <span class="at">y=</span> error, <span class="at">fill=</span>error)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha=</span> <span class="fl">0.7</span>, <span class="at">position=</span><span class="st">'dodge'</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>() <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>fecha) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"#60B64F"</span>, <span class="at">mid=</span> <span class="st">"#FAFF5F"</span>, <span class="at">high =</span> <span class="st">"#FF665F"</span>, <span class="at">midpoint =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="entrega-grupal_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Se ha decidido que una gran opción para visualizar la cantidad de error en general era dividirlo por partidos para posteriormente (ejercicio 9) calcular la media respecto al error de cada año. Para ello se ha calculado la candidatura total de todo el país para cada fecha, los votos totales por partido y se ha realizado una gráfica para visualizarlo.</p>
<p>Para visualizar el error entre el porcentaje de votos estimados y el porcentaje de votos reales, se ha realizado la diferencia entre ambas en vez del error cuadrático medio por que se ha entendido que como el formato ya es de porcentajes la diferencia serviría para ver este error. El porcentaje de votos reales a cada partido se ha calculado sobre la suma de los votos de cada partido entre los votos de candidatura. En el gráfico se puede ver que por razones obvias el error en el apartado otros es mayor ya que se ha englobado una gran cantidad de partidos en esta categoría. Aquí se calcula con la estimación media sin tener en cuenta que casa encuestadora aporta el valor. A nivel general, se puede asumir que el error oscila hasta aproximadamente el 4% de error (sin contar el apartado OTROS). Por otro lado, se han ordenado los del primer gráfico de menor a mayor error y se ha mantenido el orden para el segundo para poder comparar entre las dos elecciones distintas. En las elecciones de abril destacan errores mas altos en Más País y en el PP, mientras que en las de noviembre se observa una gran subida del error respecto a ciudadanos y a Vox.</p>
</section>
<section id="ejercicio-9" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-9">Ejercicio 9</h4>
<ul>
<li>¿En qué elección se equivocaron más las encuestas?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ejer8 <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">error_medio=</span> <span class="fu">mean</span>(error))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  fecha      error_medio
  &lt;date&gt;           &lt;dbl&gt;
1 2019-04-01        2.43
2 2019-11-01        3.42</code></pre>
</div>
</div>
<p>Las elecciones de abril a simple vista tienen menos error cometido medio, por lo que se daría por hecho que las de noviembre tienen un error mas pronunciado. Pero gracias a los gráficos realizados anteriormente, se puede realizar un análisis más profundo aunque se llegue a la misma conclusión. Respecto a las elecciones de noviembre se mantienen los errores de la sección OTROS que no se tendra en cuenta y descienden los niveles de error en general, pero se mantiene el de Más País y se dispara por completo el de ciudadanos ocasionando casi el mismo error que el apartado otros. Esto hace que aunque la diferencia de medias del error no sea muy amplia supone una más amplia por la dispersión de los datos respecto a ciudadanos en noviembre.</p>
</section>
<section id="ejercicio-10" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-10">Ejercicio 10</h4>
<ul>
<li>¿Cómo se equivocaron las encuestas en partidos de ámbito nacional (PSOE, PP, VOX, CS, MP, UP - IU)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ambito_nacional <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PSOE"</span>, <span class="st">"PP"</span>, <span class="st">"VOX"</span>, <span class="st">"MP"</span>, <span class="st">"UP"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ejer8 <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(siglas <span class="sc">%in%</span> ambito_nacional), <span class="fu">aes</span>(<span class="at">x=</span> siglas, <span class="at">y=</span> error, <span class="at">fill=</span>error)) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>fecha) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"#60B64F"</span>, <span class="at">mid=</span> <span class="st">"#FAFF5F"</span>, <span class="at">high =</span> <span class="st">"#FF665F"</span>, <span class="at">midpoint =</span> <span class="fl">2.2</span>) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_economist_white</span>() <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Partidos"</span>, <span class="at">y =</span> <span class="st">"error/ diferencia(%)"</span>) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">start =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="entrega-grupal_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Este ejercicio se basa simplemente en que con los datos anteriores se realiza un filtro para ver los errores en los partidos nacionales en ambas elecciones. Se ha cambiado el tipo de gráfico a su vez eligiendo esta opción ya que es muy visual.</p>
</section>
<section id="ejercicio-11" class="level4">
<h4 class="anchored" data-anchor-id="ejercicio-11">Ejercicio 11</h4>
<ul>
<li>¿Qué casas encuestadores acertaron más y cuales se desviaron más de los resultados?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>candidatura_total <span class="ot">&lt;-</span>        <span class="co">#Reciclada del ejercicio 8 esta función.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha) <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cod_mun, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">candidatura_total=</span> <span class="fu">sum</span>(votos_candidaturas)) <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(fecha, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (<span class="fu">c</span>(fecha, candidatura_total)) <span class="sc">|&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(fecha)<span class="sc">==</span><span class="dv">2019</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>encuestas_tidy3 <span class="ot">&lt;-</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  encuestas_tidy <span class="sc">|&gt;</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(Estimación<span class="ot">=</span> <span class="fu">mean</span>(Estimación), <span class="at">.by =</span> <span class="fu">c</span>(siglas, date_elec, pollster))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>ejer11 <span class="ot">&lt;-</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>datos_elecciones_tidy <span class="sc">|&gt;</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(fecha)<span class="sc">==</span><span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votos_totales =</span> <span class="fu">sum</span>(Votos), <span class="at">.by =</span> <span class="fu">c</span>(fecha, siglas)) <span class="sc">|&gt;</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(candidatura_total, <span class="at">by=</span><span class="st">"fecha"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha, siglas) <span class="sc">|&gt;</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">porcentaje=</span> <span class="dv">100</span><span class="sc">*</span> votos_totales<span class="sc">/</span>candidatura_total) <span class="sc">|&gt;</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(siglas, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (<span class="fu">c</span>(Partidos<span class="sc">:</span>porcentaje))</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>ejer11 <span class="ot">&lt;-</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  ejer11 <span class="sc">|&gt;</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(encuestas_tidy3, <span class="at">by=</span><span class="st">"siglas"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha) <span class="sc">|&gt;</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error=</span> <span class="fu">abs</span>(porcentaje<span class="sc">-</span>Estimación)) <span class="sc">|&gt;</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pollster, siglas) <span class="sc">|&gt;</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">"MediaErrorPollster"</span><span class="ot">=</span><span class="fu">mean</span>(error))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(ejer11, encuestas_tidy3, by = "siglas"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 4 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'pollster'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ejer11, <span class="fu">aes</span>(<span class="at">x=</span> siglas, <span class="at">y=</span> MediaErrorPollster, <span class="at">fill=</span> MediaErrorPollster)) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha=</span> <span class="fl">0.7</span>, <span class="at">position=</span><span class="st">'dodge'</span>) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_fill_colorblind</span>() <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>pollster) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"#60B64F"</span>, <span class="at">mid=</span> <span class="st">"#FAFF5F"</span>, <span class="at">high =</span> <span class="st">"#FF665F"</span>, <span class="at">midpoint =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for fill is already present.
Adding another scale for fill, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="entrega-grupal_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ejer11 <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pollster) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">error_medio=</span> <span class="fu">mean</span>(MediaErrorPollster))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   pollster          error_medio
   &lt;chr&gt;                   &lt;dbl&gt;
 1 CELESTE-TEL              3.47
 2 CIS                      4.33
 3 ELECTOPANEL              3.11
 4 GAD3                     3.76
 5 GESOP                    3.66
 6 HAMALGAMA MÉTRICA        4.32
 7 IMOP                     3.11
 8 SIGMA DOS                3.09
 9 SOCIOMÉTRICA             3.01
10 SW DEMOSCOPIA            3.60</code></pre>
</div>
</div>
<p>Para ver los niveles de error de las distintas casas encuestadoras se ha calculado el porcentaje estimado medio de cada pollster de cada partido en total de las dos elecciones. Para posteriormente compararlo con los valores reales asi como se ha hecho con el resto de apartados de los errores cometidos. Tras ello se ha realizado una grafica con los niveles de error de cada casa para partido además de su media. En cuanto a los errores medios de cada pollster se puede afirmar que tienen errores medios muy parecidos rondando el 3-4% de error.</p>
<p>Pero se necesita estudiar más a profundidad por la presencia de como se ha mencionado anteriormente del apartado Otros. No se ha querido eliminar este columna en los distintos ejercicios para poder explicar que al existir muchos partidos en ese apartado existe mucha dispersión y es díficil que sus niveles de error sean bajos.</p>
<p>Se observa como todos los gráficos carecen de esa exactitud en Otros, pero observamos que existen grandes candidatos a ser una gran aproximación. A nivel general, casi todas las pollsters pronosticaban un valor bastante más disociado de partidos como sobretodo Ciudadanos, aunque también con Unidas Podemos. A nivel regularidad IMOP consigue un error muy regular en casi todos los partidos, aunque también destacan SOCIOMÉTRICA, a pesar de su gran error con Ciudadanos, y Sigma Dos. Otras pollsters como el propio CIS, HAMALGAMA MÉTRICA tienen niveles de error mucho más altos.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>